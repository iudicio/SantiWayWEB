{% load static %}
<!DOCTYPE html>
<html lang="ru" xmlns="http://www.w3.org/1999/html">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

  <link rel="stylesheet" href="{% static '/css/main.css' %}">
  <link rel="stylesheet" href="{% static 'interface/dashboard.css' %}">
  <link rel="stylesheet" href="{% static 'interface/notifications_and_map.css' %}"/>
  <link rel="stylesheet" href="{% static 'interface/collapsible.css' %}">

  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>

  <script>
    window.APP_CONFIG = {
      API_BASE: "{{ API_BASE|default:'/api' }}",
      API_KEY: "{{ API_KEY|default:'' }}",
    };
    const API_USER_INFO = "{% url 'api:userinfo' %}"
    const API_FILTERING = "{% url 'api:filtering-list' %}"
  </script>

  <script src="{% static 'interface/get-devices.js' %}"></script>
  <script type="module" src="{% static 'interface/custom-elements.js' %}"></script>
  <script type="module" src="{% static 'interface/app.js' %}?v=3"></script>
  <script src="{% static '/js/background.js' %}"></script>
  <title>Locator</title>
</head>
<body>
  <canvas id="network-canvas"></canvas>

  <!-- NAV -->
  <nav class="navbar">
    <div class="nav-actions">
      <a href="#" class="nav-link active">–î–∞—à–±–æ—Ä–¥</a>
      <a href="{%url 'users:profile_overview' %}" class="nav-link">–ü—Ä–æ—Ñ–∏–ª—å / API</a>
      <button class="notifications-btn" id="notificationsBtn">
        üîî
        <span class="notifications-badge" id="notificationsBadge" style="display: none;">0</span>
      </button>
      <a href="{% url 'users:logout' %}" class="nav-link logout-link">–í—ã–π—Ç–∏</a>
    </div>
  </nav>

  <main class="main">
    <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å ‚Äî —Ñ–∏–ª—å—Ç—Ä—ã -->
    <aside class="sidebar" aria-label="–§–∏–ª—å—Ç—Ä—ã">
      <h2 class="section-title">–§–∏–ª—å—Ç—Ä—ã</h2>

      <div class="form" id="filtersForm" autocomplete="off">
        <div class="form-group">
          <label for="apiList">–í—ã–±—Ä–∞—Ç—å API</label>
          <div class="collapsible-wrapper">
            <div class="collapsible-header">
              <span class="selection-status">–í—ã–±—Ä–∞–Ω–æ: 0</span>
              <span class="arrow"></span>
            </div>
            <div id="apiList" class="collapsible-content">
              <!-- –ê–ø–∏-–∫–ª—é—á–∏ -->
              <label class="custom-checkbox select-all">
                <input type="checkbox" value="__all__">–í—ã–±—Ä–∞—Ç—å –≤—Å—ë
              </label>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="deviceList">–í—ã–±—Ä–∞—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</label>
          <div class="collapsible-wrapper">
            <div class="collapsible-header">
              <span class="selection-status">–í—ã–±—Ä–∞–Ω–æ: 0</span>
              <span class="arrow"></span>
            </div>
            <div id="deviceList" class="collapsible-content">
              <!-- –°–ø–∏—Å–æ–∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
              <label class="custom-checkbox select-all">
                <input type="checkbox" value="__all__">–í—ã–±—Ä–∞—Ç—å –≤—Å—ë
              </label>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="folderList">–í—ã–±—Ä–∞—Ç—å –ø–∞–ø–∫—É</label>
          <div class="collapsible-wrapper">
            <div class="collapsible-header">
              <span class="selection-status">–í—ã–±—Ä–∞–Ω–æ: 0</span>
              <span class="arrow"></span>
            </div>
            <div id="folderList" class="collapsible-content">
              <!-- –°–ø–∏—Å–æ–∫ –ø–∞–ø–æ–∫ -->
              <label class="custom-checkbox select-all">
                <input type="checkbox" value="__all__">–í—ã–±—Ä–∞—Ç—å –≤—Å—ë
              </label>
            </div>
          </div>
        </div>

        <div class="form-group">
          <label for="time-start">–í—Ä–µ–º—è –æ—Ç</label>
          <input id="time-start" type="datetime-local" name="f_time_start" />
        </div>

          <div class="form-group">
          <label for="time-end">–í—Ä–µ–º—è –¥–æ</label>
          <input id="time-end" type="datetime-local" name="f_time_end" />
        </div>

        <div class="form-group">
          <label for="f-network">–¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</label>
          <!-- custom-select –≤ js –ø—Ä–æ–ø–∏—Å–∞–Ω  -->
          <select id="f-network" class="custom-select" name="f_network">
            <option value="any">–õ—é–±–æ–π</option>
            <option value="WiFi">WiFi</option>
            <option value="Bluetooth">Bluetooth</option>
            <option value="Cellular">Cellular</option>
          </select>
        </div>

        <div class="form-group">
          <label for="f-mac">MAC</label>
          <input id="f-mac" name="f_mac" placeholder="id" />
        </div>

        <div class="form-group">
          <label for="f-name">–ò–º—è</label>
          <input id="f-name" name="f_name" placeholder="Name" />
        </div>
        <div class="checkbox-group">
          <label class="custom-checkbox">
            <input type="checkbox" id="f-alert" name="f_alert" />
            <span>–¢—Ä–µ–≤–æ–∂–Ω–æ–µ</span>
          </label>

          <label class="custom-checkbox">
            <input type="checkbox" id="f-ignore" name="f_ignore" />
            <span>–ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º–æ–µ</span>
          </label>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn-primary" id="btnApplyFilters">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
        </div>
      </div>
    </aside>

    <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å ‚Äî –∫–æ–Ω—Ç–µ–Ω—Ç –¥–∞—à–±–æ—Ä–¥–∞ -->
    <section class="content">
      <!-- –ö–∞—Ä—Ç–∞ -->
      <div class="card">
        <div class="card-header">
          <span class="text-muted">–ö–∞—Ä—Ç–∞ –õ–æ–∫–∞—Ü–∏–π</span>
          <span class="text-muted">–í—ã–±—Ä–∞–Ω–æ: <span id="selected-id">‚Äî</span></span>
        </div>
        <div id="map" class="map-root" role="region" aria-label="–ö–∞—Ä—Ç–∞ –ª–æ–∫–∞—Ü–∏–π"></div>
      </div>

      <!-- –¢–∞–±–ª–∏—Ü–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
      <div class="card">
        <div class="card-header">
          <span class="text-muted">–î–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤</span>

          <div class="table-stats">
            <div class="stat-item total">–í—Å–µ–≥–æ: <span id="stat-total">12</span></div>
            <div class="stat-item filtered">–û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–æ: <span id="stat-filtered">1</span></div>
            <div class="stat-item alert">–¢—Ä–µ–≤–æ–∂–Ω—ã—Ö: <span id="stat-alert">3</span></div>
            <div class="stat-item ignore">–ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º—ã—Ö: <span id="stat-ignore">4</span></div>
          </div>
        </div>


        <!-- –ö–æ–Ω—Ç—Ä–æ–ª—ã —Ç–∞–±–ª–∏—Ü—ã -->
        <div class="table-controls">
          <div class="controls-left">
            –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å
            <select id="pageSize" class="custom-select">
              <option>10</option>
              <option>25</option>
              <option>50</option>
              <option>100</option>
            </select>
            –∑–∞–ø–∏—Å–µ–π
          </div>

          <div class="controls-right">
            –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫:
            <input id="tableSearch" class="search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å" />

            <div class="table-settings" style="position: relative;">
              <button id="columnsToggle" class="settings-btn" type="button" aria-expanded="false" aria-controls="columnsMenu">
                <img src="{% static 'interface/settings.png' %}" alt="–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç–æ–ª–±—Ü–æ–≤" />
              </button>

              <div id="columnsMenu" class="columns-menu hidden" role="menu" aria-hidden="true"></div>
            </div>
          </div>
        </div>

        <!-- –¢–∞–±–ª–∏—Ü–∞ -->
        <div class="table-container">
          <table id="devicesTable" class="table" aria-describedby="table-info">
            <thead>
              <tr>
                <th>Device ID</th>
                <th>User Phone MAC</th>
                <th>Latitude</th>
                <th>Longitude</th>
                <th>Location</th>
                <th>Signal Strength</th>
                <th>Network Type</th>
                <th>Is Ignored</th>
                <th>Is Alert</th>
                <th>User API</th>
                <th>Detected At</th>
                <th>Folder Name</th>
                <th>System Folder Name</th>
              </tr>
            </thead>
            <tbody>
              <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
            </tbody>
          </table>
        </div>

        <!-- –§—É—Ç–µ—Ä —Ç–∞–±–ª–∏—Ü—ã -->
        <div class="table-footer" id="table-info">
          <div id="showing">
          </div>
          <div id="pagination"></div>
          <div class="pagination-controls">
            <button class="page-btn" id="prevPage">&laquo; –ù–∞–∑–∞–¥</button>
            <span id="pageNumbers" class="page-numbers"></span>
            <button class="page-btn" id="nextPage">–í–ø–µ—Ä–µ–¥ &raquo;</button>
          </div>
        </div>
      </div>
    </section>
  </main>

<!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
<div class="notification-container" id="notificationContainer"></div>

<!-- –ü–∞–Ω–µ–ª—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π -->
<div class="notifications-overlay" id="notificationsOverlay"></div>

<div class="notifications-panel" id="notificationsPanel">
  <div class="notifications-header">
    <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
    <button class="notifications-close" id="notificationsCloseBtn">√ó</button>
  </div>
  <div class="notifications-body" id="notificationsBody">
    <div class="notifications-empty" id="notificationsEmpty">
      <div class="notifications-empty-icon">üîî</div>
      <p>–ù–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</p>
    </div>
  </div>
</div>

</body>
</html>